#version 150
#moj_import <light.glsl>
#moj_import <fog.glsl>
in vec3 Position;in vec4 Color;in vec2 UV0;in ivec2 UV1;in ivec2 UV2;in vec3 Normal;uniform sampler2D Sampler0;uniform sampler2D Sampler1;uniform sampler2D Sampler2;uniform mat4 ModelViewMat;uniform mat4 ProjMat;uniform mat3 IViewRotMat;uniform vec3 Light0_Direction;uniform vec3 Light1_Direction;uniform int FogShape;out float vertexDistance;out vec4 vertexColor;out vec4 lightMapColor;out vec4 overlayColor;out vec2 texCoord0;out vec2 texCoord1;out vec4 normal;out float part;const vec4[] subuvs=vec4[](vec4(4.,0.,8.,4.),vec4(8.,0.,12.,4.),vec4(0.,4.,4.,16.),vec4(4.,4.,8.,16.),vec4(8.,4.,12.,16.),vec4(12.,4.,16.,16.),vec4(4.,0.,7.,4.),vec4(7.,0.,10.,4.),vec4(0.,4.,4.,16.),vec4(4.,4.,7.,16.),vec4(7.,4.,11.,16.),vec4(11.,4.,14.,16.),vec4(4.,0.,12.,4.),vec4(12.,0.,20.,4.),vec4(0.,4.,4.,16.),vec4(4.,4.,12.,16.),vec4(12.,4.,16.,16.),vec4(16.,4.,24.,16.));const vec2[] origins=vec2[](vec2(40.,16.),vec2(40.,32.),vec2(32.,48.),vec2(48.,48.),vec2(40.,16.),vec2(40.,32.),vec2(32.,48.),vec2(48.,48.),vec2(16.,16.),vec2(16.,32.),vec2(0.,16.),vec2(0.,32.),vec2(16.,48.),vec2(0.,48.));void main(){vertexColor=minecraft_mix_light(Light0_Direction,Light1_Direction,normalize(Normal),Color);lightMapColor=texelFetch(Sampler2,UV2/16,0);overlayColor=texelFetch(Sampler1,UV1,0);normal=ProjMat*ModelViewMat*vec4(Normal,0.);ivec2 dim=textureSize(Sampler0,0);if(ProjMat[2][3]==0.||dim.x!=64||dim.y!=64){part=0.;texCoord0=UV0;texCoord1=vec2(0.);vertexDistance=fog_distance(ModelViewMat,IViewRotMat*Position,FogShape);gl_Position=ProjMat*ModelViewMat*vec4(Position,1.);}else {vec3 wpos=IViewRotMat*Position;vec2 UVout=UV0;vec2 UVout2=vec2(0.);int partId=-int((wpos.y-0.5*1024.)/1024.);part=float(partId);if(partId==0)gl_Position=ProjMat*ModelViewMat*vec4(Position,1.);else {int outerLayer=gl_VertexID/24%2;int tFaceId=gl_VertexID%24/4;int vertexId=gl_VertexID%4;int u=int(UV0.x*64);int v=int(UV0.y*64);switch(vertexId){case 0:u-=8;break;case 1:break;case 2:v-=8;break;case 3:u-=8;v-=8;break;}int faceId=1;int pixel=u+v*16;if(v>=0)switch(pixel){case 8:case 40:faceId=0;break;case 128:case 160:faceId=2;break;case 136:case 168:faceId=3;break;case 144:case 176:faceId=4;break;case 152:case 184:faceId=5;break;}if(tFaceId==1)if(pixel!=128&&pixel!=160)faceId=1;else if(tFaceId==3)if(pixel!=136&&pixel!=168)faceId=1;int subuvIndex=faceId;wpos.y+=1024.*partId;gl_Position=ProjMat*ModelViewMat*vec4(inverse(IViewRotMat)*wpos,1.);UVout=origins[2*(partId-1)+outerLayer];UVout2=origins[2*(partId-1)];if(partId==3||partId==4)subuvIndex+=6;else if(partId==5)subuvIndex+=12;vec4 subuv=subuvs[subuvIndex];vec2 offset=vec2(0.);if(faceId==1)if(vertexId==0)offset+=subuv.zw;else if(vertexId==1)offset+=subuv.xw;else if(vertexId==2)offset+=subuv.xy;else offset+=subuv.zy;else if(vertexId==0)offset+=subuv.zy;else if(vertexId==1)offset+=subuv.xy;else if(vertexId==2)offset+=subuv.xw;else offset+=subuv.zw;UVout+=offset;UVout2+=offset;UVout/=64.;UVout2/=64.;}vertexDistance=fog_distance(ModelViewMat,wpos,FogShape);texCoord0=UVout;texCoord1=UVout2;}}